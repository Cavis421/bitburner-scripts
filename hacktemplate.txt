/** @param {NS} ns */
export async function main(ns) {
    // Define CLI flags (with a default target)
    const flags = ns.flags([
        ['target', 'joesguns'], // default value
    ]);

    const target = flags.target;

    // Basic safety check
    if (!target) {
        ns.tprint("ERROR: No target provided. Usage: run hack.js --target n00dles");
        return;
    }

    const moneyThresh = ns.getServerMaxMoney(target);
    const securityThresh = ns.getServerMinSecurityLevel(target);

    if (ns.fileExists("BruteSSH.exe", "home")) {
        ns.brutessh(target);
    }

    ns.nuke(target);

    while (true) {
        if (ns.getServerSecurityLevel(target) > securityThresh) {
            await ns.weaken(target);
        } else if (ns.getServerMoneyAvailable(target) < moneyThresh) {
            await ns.grow(target);
        } else {
            await ns.hack(target);
        }
    }
}
